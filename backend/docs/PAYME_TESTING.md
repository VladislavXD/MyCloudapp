# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Payme Integration

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API –∏–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞. –ó–∞–ø–æ–º–Ω–∏—Ç–µ `order_id`.

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç callback

```bash
cd backend
node test-payme-callback.js <order_id> <amount>
```

–ü—Ä–∏–º–µ—Ä:
```bash
node test-payme-callback.js 14 65000
```

### 3. –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

–°–∫—Ä–∏–ø—Ç —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª Payme –ø–ª–∞—Ç–µ–∂–∞:

1. **CheckPerformTransaction** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–∞
2. **CreateTransaction** - –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. **CheckTransaction** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
4. **PerformTransaction** - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

### 4. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
üöÄ Payme Callback Test Suite
============================
Base URL: http://localhost:5000
Merchant ID: 65b78f9f3c319dec9d89218f
============================

Testing with Order ID: 14, Amount: 65000 UZS

üîç Test 1: CheckPerformTransaction
Order ID: 14, Amount: 65000 UZS

‚úÖ Response: {
  "result": {
    "allow": true,
    ...
  }
}

üìù Test 2: CreateTransaction
Order ID: 14, Amount: 65000 UZS

‚úÖ Response: {
  "result": {
    "create_time": 1728648000000,
    "transaction": "14-1728648000000",
    "state": 1
  }
}

‚úÖ All tests passed! Payment completed successfully.

You can now check order 14 status - it should be "paid" and "active".
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞

```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
TOKEN="your_jwt_token"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
curl -X GET http://localhost:5000/api/orders/14 \
  -H "Authorization: Bearer $TOKEN"
```

–ó–∞–∫–∞–∑ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å—Ç–∞—Ç—É—Å:
- `status: "active"`
- `payment_status: "paid"`
- `payment_method: "payme"`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ Payme

### –î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –ò–∑–º–µ–Ω–∏—Ç–µ URL –≤ `.env`:
```bash
PAYME_URL=https://test.paycom.uz
```

2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π Merchant ID –æ—Ç Payme

3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:
   - –ù–æ–º–µ—Ä: 8600 4954 0000 0031
   - –°—Ä–æ–∫: 03/99
   - –°–ú–° –∫–æ–¥: 666666

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://business.paycom.uz
2. –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π Merchant ID –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:
```bash
PAYME_MERCHANT_ID=your_real_merchant_id
PAYME_SECRET_KEY=your_real_secret_key
PAYME_URL=https://checkout.paycom.uz
```

## –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞: "[object Object]" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Payme

**–ü—Ä–∏—á–∏–Ω–∞**: Merchant ID –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - —Ç–∞–º –±—É–¥–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Merchant ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (24 —Å–∏–º–≤–æ–ª–∞)
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ Payme
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –û—à–∏–±–∫–∞: "Authorization failed"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–µ—Ä–Ω—ã–π Secret Key

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ .env
PAYME_SECRET_KEY=correct_secret_key
```

### –û—à–∏–±–∫–∞: "Order not found"

**–ü—Ä–∏—á–∏–Ω–∞**: Order ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω

**–†–µ—à–µ–Ω–∏–µ**:
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π order_id –≤ —Ç–µ—Å—Ç–µ

### –û—à–∏–±–∫–∞: "Invalid amount"

**–ü—Ä–∏—á–∏–Ω–∞**: –°—É–º–º–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å—É–º–º–æ–π –∑–∞–∫–∞–∑–∞

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É
node test-payme-callback.js 14 65000  # 65000 UZS
```

## –õ–æ–≥–∏

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Payme callback –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏:

```
================================================================================
[2025-10-11T10:00:00.000Z] üí≥ PAYME REQUEST: CheckPerformTransaction
{
  "method": "CheckPerformTransaction",
  "params": {
    "amount": 6500000,
    "account": {
      "order_id": "14"
    }
  }
}
================================================================================
```

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Payme](./PAYME_SETUP.md)
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Payme](https://developer.help.paycom.uz)
- [Merchant API –º–µ—Ç–æ–¥—ã](https://developer.help.paycom.uz/metody-merchant-api)
